<?php
/**
 * Copyright © Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */

/**
 * Template for displaying grouped product price
 */
?>
<?php
$minProduct = $block->getSaleableItem()
    ->getPriceInfo()
    ->getPrice(\Magento\Catalog\Pricing\Price\FinalPrice::PRICE_CODE)
    ->getMinProduct();

if ($minProduct) {
    $amountRender = $block->getRendererPool()
        ->createAmountRender(
            $minProduct->getPriceInfo()->getPrice('final_price')->getAmount(),
            $minProduct,
            $minProduct->getPriceInfo()->getPrice('final_price'),
            ['include_container' => true]
        );
}
?>
<div class="price-box">
    <?php if ($minProduct && \Magento\Framework\Pricing\Render::ZONE_ITEM_VIEW != $block->getZone()) : ?>
        <p class="minimal-price">
    <?php if ($_product->getTypeId() == \Magento\GroupedProduct\Model\Product\Type\Grouped::TYPE_CODE): ?>
        <?php
        // Получаем связанные продукты
        $_associatedProducts = $_product->getTypeInstance()->getAssociatedProducts($_product);
        $totalPrice = 0;

        // Рассчитываем итоговую цену для всех продуктов
        foreach ($_associatedProducts as $_item) {
            $totalPrice += $_item->getFinalPrice();
        }
        ?>
        <?php if ($totalPrice > 0): ?>
            <span class="price-label"><?php echo __('Total Price:'); ?></span>
            <span class="price"><?php echo $block->escapeHtml($block->getLayout()->createBlock(\Magento\Framework\Pricing\Helper\Data::class)->currency($totalPrice, true, false)); ?></span>
        <?php endif; ?>
    <?php endif; ?>
</p>

    <?php endif ?>
</div>
