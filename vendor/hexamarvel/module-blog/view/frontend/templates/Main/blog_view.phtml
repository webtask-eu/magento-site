<?php
/**
 * @author Hexamarvel Team
 * @copyright Copyright (c) 2021 Hexamarvel (https://www.hexamarvel.com)
 * @package Hexamarvel_Blog
 */

 /** $block \Hexamarvel\Blog\Block\PostView */
?>
<?php
$post = $block->getPost();?>
<?php if ($block->getPageLayout() == 'column-left'): ?>
    <div class="blog-sidebar left-sidebar">
        <?php $recentBlogs = $block->getRecentBlogs(); ?>
        <?php if (count($recentBlogs)): ?>
            <div class="sidebar-recent">
                <h4><?= /*@noEscape*/ __('Recent Posts'); ?></h4>
                <?php foreach ($recentBlogs as $blog): ?>
                    <a href="<?= /*@noEscape*/ $block->getPostUrl($blog); ?>" title="<?= /*@noEscape*/ $blog->getTitle(); ?>">
                        <?= /*@noEscape*/ $blog->getTitle(); ?>
                    </a>
                <?php endforeach;?>
            </div>
        <?php endif;?>
        <?php $categories = $block->getSidebarCategories(); ?>
        <?php if (count($categories)): ?>
            <div class="sidebar-recent">
                <h4><?= /*@noEscape*/ __('Categories'); ?></h4>
                <?php foreach ($categories as $category): ?>
                    <a href="<?= /*@noEscape*/ $block->getCategoryUrl($category); ?>"
                        title="<?= /*@noEscape*/ $category->getCategoryTitle(); ?>">
                        <?= /*@noEscape*/ $category->getCategoryTitle(); ?>
                    </a>
                <?php endforeach;?>
            </div>
        <?php endif;?>
    </div>
<?php endif; ?>
<div class="postWrapper <?= /*noEscape*/ $block->getPageLayout(); ?>">
     <?php if ($post->getBlogImage()):?>
         <div class="postImage">
             <img src="<?= /*@noEscape*/ $block->getImage($post->getBlogImage()); ?>"
                  title="<?= /*@noEscape*/ $post->getTitle(); ?>"
                  alt="<?= /*@noEscape*/ $post->getTitle(); ?>"
             />
         </div>
     <?php endif;?>
    <div class="postContent std">
        <?= /*@noEscape*/ $block->getContent($post->getContent()); ?>
    </div>
    <div class="postview_bottom">
        <span class="botton-accessories">
            <?php if ($createdDate = $block->getCreatedDate($post)): ?>
                <strong><i><?= /*@noEscape*/ __('Posted On'); ?></i></strong>:
                <i><?= /*@noEscape*/ $createdDate; ?></i>
            <?php endif;?>
        </span>
        <span class="botton-accessories">
            <?php if ($categories = $post->getCategory()): ?>
                <strong><i><?= /*@noEscape*/ __('Categories'); ?></i></strong>:
                <i><?= /*@noEscape*/ $block->getCategories($categories); ?></i>
            <?php endif;?>
        </span>
        <span class="botton-accessories">
            <?php if ($author = $post->getAuthor()): ?>
                <strong><i><?= /*@noEscape*/ __('Posted By'); ?></i></strong>:
                <i><?= /*@noEscape*/ $author; ?></i>
            <?php endif;?>
        </span>
    </div>

    <?php $productCollection = $block->getRelatedProducts($post);?>
    <?php if (count($productCollection)):?>
        <div class="related-product-title">
            <h4><?= /*@noEscape*/ __('Related Products'); ?></h4>
        </div>
        <div class="block widget block-products-list grid">
            <div class="block-content">
                <div class="products-grid grid">
                    <ol class="product-items widget-product-grid">
                        <?php foreach ($productCollection as $key => $_item):?>
                            <li class="product-item">
                                <div class="product-item-info">
                                    <a href="<?= $block->escapeUrl($block->getProductUrl($_item)) ?>" class="product photo product-item-photo">
                                        <?= $block->getProductImage($_item, 'related_products_list')->toHtml() ?>
                                    </a>
                                    <div class="product details product-item-details">
                                    <strong class="product name product-item-name">
                                        <a class="product-item-link" title="<?= $block->escapeHtmlAttr($_item->getName()) ?>" href="<?= $block->escapeUrl($block->getProductUrl($_item)) ?>">
                                            <?= $block->escapeHtml($_item->getName()) ?>
                                        </a>
                                    </strong>

                                    <?= /* @noEscape */ $block->getProductPrice($_item) ?>

                                    <div class="product actions product-item-actions">
                                        <div class="actions-primary">
                                            <?php if ($_item->isSaleable()):?>
                                                <?php if ($_item->getTypeInstance()->hasRequiredOptions($_item)):?>
                                                    <button class="action tocart primary" data-mage-init='{"redirectUrl": {"url": "<?= $block->escapeUrl($block->getAddToCartUrl($_item)) ?>"}}' type="button" title="<?= $block->escapeHtmlAttr(__('Add to Cart')) ?>">
                                                        <span><?= $block->escapeHtml(__('Add to Cart')) ?></span>
                                                    </button>
                                                <?php else:?>
                                                    <?php $postDataHelper = $this->helper(Magento\Framework\Data\Helper\PostHelper::class);
                                                    $postData = $postDataHelper->getPostData($block->escapeUrl($block->getAddToCartUrl($_item)), ['product' => $_item->getEntityId()])
                                                    ?>
                                                    <button class="action tocart primary"
                                                            data-post='<?= /* @noEscape */ $postData ?>'
                                                            type="button" title="<?= $block->escapeHtmlAttr(__('Add to Cart')) ?>">
                                                        <span><?= $block->escapeHtml(__('Add to Cart')) ?></span>
                                                    </button>
                                                <?php endif; ?>
                                            <?php else:?>
                                                <?php if ($_item->getIsSalable()):?>
                                                    <div class="stock available"><span><?= $block->escapeHtml(__('In stock')) ?></span></div>
                                                <?php else:?>
                                                    <div class="stock unavailable"><span><?= $block->escapeHtml(__('Out of stock')) ?></span></div>
                                                <?php endif; ?>
                                            <?php endif; ?>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        <?php endforeach;?>
                    </ol>
                </div>
            </div>
        </div>
    <?php endif; ?>

</div>
<?php if ($block->getPageLayout() == 'column-right'): ?>
    <div class="blog-sidebar right-sidebar">
        <?php $recentBlogs = $block->getRecentBlogs(); ?>
        <?php if (count($recentBlogs)): ?>
            <div class="sidebar-recent">
                <h4><?= /*@noEscape*/ __('Recent Posts'); ?></h4>
                <?php foreach ($recentBlogs as $blog): ?>
                    <a href="<?= /*@noEscape*/ $block->getPostUrl($blog); ?>" title="<?= /*@noEscape*/ $blog->getTitle(); ?>">
                        <?= /*@noEscape*/ $blog->getTitle(); ?>
                    </a>
                <?php endforeach;?>
            </div>
        <?php endif;?>
        <?php $categories = $block->getSidebarCategories(); ?>
        <?php if (count($categories)): ?>
            <div class="sidebar-recent">
                <h4><?= /*@noEscape*/ __('Categories'); ?></h4>
                <?php foreach ($categories as $category): ?>
                    <a href="<?= /*@noEscape*/ $block->getCategoryUrl($category); ?>"
                        title="<?= /*@noEscape*/ $category->getCategoryTitle(); ?>">
                        <?= /*@noEscape*/ $category->getCategoryTitle(); ?>
                    </a>
                <?php endforeach;?>
            </div>
        <?php endif;?>
    </div>
<?php endif; ?>
